#!/bin/bash

# GitHub è‡ªåŠ¨ä¸Šä¼ è„šæœ¬
# å°†ç”Ÿæˆçš„æ–‡æ¡£æ¨é€åˆ° GitHub

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="/root/clawd"
REPO_NAME="ultimate-skills-bundle"
BRANCH="main"
DOCS_PATH="ai-content-tracker/docs"

echo "ğŸš€ å‡†å¤‡ä¸Šä¼ æ–‡æ¡£åˆ° GitHub..."
echo ""

# æ£€æŸ¥ä»“åº“
REPO_PATH="$PROJECT_ROOT/$REPO_NAME"

if [ ! -d "$REPO_PATH" ]; then
    echo "âŒ ä»“åº“ä¸å­˜åœ¨: $REPO_PATH"
    echo ""
    echo "ğŸ’¡ ä½¿ç”¨ skills-bundle ä»“åº“: /root/clawd/skills-bundle"
    REPO_PATH="/root/clawd/skills-bundle"
fi

if [ ! -d "$REPO_PATH" ]; then
    echo "âŒ ä»“åº“ä¸å­˜åœ¨: $REPO_PATH"
    exit 1
fi

cd "$REPO_PATH"

echo "ğŸ“‚ å½“å‰ç›®å½•: $(pwd)"
echo "ğŸ”— ä»“åº“: $REPO_NAME"
echo "ğŸŒ¿ åˆ†æ”¯: $BRANCH"
echo ""

# æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„æ–‡æ¡£
DOCS_SOURCE="$SCRIPT_DIR/../docs"
DOCS_DEST="$REPO_PATH/$DOCS_PATH"

if [ ! -d "$DOCS_DEST" ]; then
    mkdir -p "$DOCS_DEST"
fi

# å¤åˆ¶æ–°æ–‡æ¡£
if [ -d "$DOCS_SOURCE" ] && [ "$(ls -A $DOCS_SOURCE 2>/dev/null)" ]; then
    echo "ğŸ“‹ å¤åˆ¶æ–‡æ¡£..."
    cp -r $DOCS_SOURCE/* $DOCS_DEST/
    echo "âœ… æ–‡æ¡£å¤åˆ¶å®Œæˆ"
else
    echo "âš ï¸  æ²¡æœ‰æ–°çš„æ–‡æ¡£"
    exit 0
fi

echo ""
echo "ğŸ” æ£€æŸ¥æ›´æ”¹..."

# æ£€æŸ¥æ˜¯å¦æœ‰æ›´æ”¹
if [ -z "$(git status --porcelain)" ]; then
    echo "âœ… æ²¡æœ‰æ–°çš„æ›´æ”¹"
    exit 0
fi

# æ˜¾ç¤ºæ›´æ”¹
git status --short

echo ""
echo "ğŸ“ æäº¤æ›´æ”¹..."

# è·å–ä»Šå¤©çš„æ—¥æœŸ
TODAY=$(date +%Y-%m-%d)

# æäº¤
git add $DOCS_PATH/
git commit -m "docs: æ›´æ–° AI å†…å®¹æ±‡æ€» ($TODAY)

- è‡ªåŠ¨æŠ“å– AI ç©æ³•ç›¸å…³å†…å®¹
- æ›´æ–°çƒ­é—¨å†…å®¹ç»Ÿè®¡
- æ•´ç†å·¥å…·å’Œåª’ä½“æ¸…å•

Generated by: Clawdbot AI Content Tracker
Date: $TODAY"

echo "âœ… æäº¤å®Œæˆ"
echo ""
echo "ğŸ“¤ æ¨é€åˆ° GitHub..."

# æ¨é€
git push origin $BRANCH

if [ $? -eq 0 ]; then
    echo ""
    echo "âœ… æ¨é€æˆåŠŸï¼"
    echo ""
    echo "ğŸ”— æŸ¥çœ‹æ›´æ–°:"
    echo "   https://github.com/hhhh124hhhh/ultimate-skills-bundle/tree/main/$DOCS_PATH"
else
    echo "âŒ æ¨é€å¤±è´¥"
    exit 1
fi

echo ""
echo "ğŸ‰ å®Œæˆï¼"
